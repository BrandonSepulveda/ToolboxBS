<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ToolboxBS - Web UI</title>
    <!-- Librería JSZip para crear archivos ZIP en el navegador -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
    
    <!-- Analytics -->
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-9012803289038112" crossorigin="anonymous"></script>
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-2RY7LG5R21"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      gtag('config', 'G-2RY7LG5R21');
    </script>
    
    <!-- Google Fonts: Inter -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        /* --- Paleta de Colores Mejorada y Dinámica --- */
        :root {
            /* Color de acento por defecto, será sobreescrito por el selector de color */
            --accent-color: #3b82f6; /* Azul Eléctrico */
            --accent-dark: #2563eb;  /* Azul más oscuro para hover */

            --bg-color: #0D1117;
            --surface-color: #161B22;
            --surface-hover: #21262D;
            --border-color: #30363D;
            --border-hover: #8B949E;
            --text-primary: #E6EDF3;
            --text-secondary: #8B949E;
            --font-family: 'Inter', sans-serif;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        html {
            scroll-behavior: smooth;
        }

        body {
            font-family: var(--font-family);
            background-color: var(--bg-color);
            color: var(--text-primary);
            overflow-x: hidden;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }

        /* --- Header Mejorado --- */
        .header {
            background: rgba(13, 17, 23, 0.7);
            backdrop-filter: blur(12px);
            -webkit-backdrop-filter: blur(12px);
            padding: 1rem 2rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 1px solid var(--border-color);
            position: sticky;
            top: 0;
            z-index: 100;
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .logo-icon {
            width: 48px;
            height: 48px;
            background-image: url('https://github.com/BrandonSepulveda/BrandonSepulveda.github.io/blob/main/logo/BS%20ToolBox-03.png?raw=true');
            background-size: contain;
            background-repeat: no-repeat;
            background-position: center;
            filter: drop-shadow(0 0 10px var(--accent-color)); /* Sombra con color de acento */
            transition: filter 0.3s ease;
        }
        .logo-icon:hover {
            filter: drop-shadow(0 0 15px var(--accent-color));
        }

        .logo-text h1 {
            font-size: 1.25rem;
            font-weight: 600;
            color: var(--text-primary);
        }

        .logo-text p {
            font-size: 0.8rem;
            color: var(--text-secondary);
        }

        .nav {
            display: flex;
            align-items: center;
            gap: 1.5rem;
        }

        .nav a, .window-btn {
            position: relative;
        }
        
        .nav a {
            color: var(--text-secondary);
            text-decoration: none;
            font-size: 0.9rem;
            font-weight: 500;
            transition: color 0.3s ease;
            padding: 5px 0;
        }

        .nav a:hover {
            color: var(--accent-color);
        }

        /* --- Selector de Color --- */
        .color-picker-wrapper {
            position: relative;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        .color-picker-wrapper label {
            color: var(--text-secondary);
            font-size: 1.2rem;
            cursor: pointer;
            transition: color 0.3s ease;
        }
        .color-picker-wrapper label:hover {
            color: var(--accent-color);
        }
        #colorPicker {
            -webkit-appearance: none;
            -moz-appearance: none;
            appearance: none;
            width: 28px;
            height: 28px;
            background-color: transparent;
            border: none;
            cursor: pointer;
        }
        #colorPicker::-webkit-color-swatch {
            border-radius: 50%;
            border: 2px solid var(--border-color);
            transition: border-color 0.3s ease;
        }
        #colorPicker::-webkit-color-swatch:hover {
             border-color: var(--accent-color);
        }
        #colorPicker::-moz-color-swatch {
            border-radius: 50%;
            border: 2px solid var(--border-color);
        }

        .window-controls {
            display: flex;
            gap: 0.5rem;
        }

        .window-btn {
            width: 30px;
            height: 30px;
            background: transparent;
            border-radius: 50%;
            border: none;
            color: var(--text-secondary);
            cursor: pointer;
            font-size: 1rem;
            transition: background 0.3s ease, color 0.3s ease;
        }

        .window-btn:hover {
            background: var(--surface-hover);
            color: var(--text-primary);
        }

        /* --- Contenido Principal Mejorado --- */
        .main-content {
            padding: 4rem 2rem;
            text-align: center;
            flex-grow: 1;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
        }

        .page-title {
            font-size: clamp(2rem, 5vw, 3.5rem);
            font-weight: 700;
            margin-bottom: 1.5rem;
            color: var(--text-primary);
            letter-spacing: -0.05em;
        }
        .page-title span {
            color: var(--accent-color);
        }
        
        .page-subtitle {
            font-size: 1.125rem;
            font-weight: 400;
            margin-bottom: 4rem;
            color: var(--text-secondary);
            max-width: 600px;
            line-height: 1.6;
        }

        .tools-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 1.5rem;
            max-width: 1100px;
            width: 100%;
            margin: 0 auto;
        }

        .tool-card {
            background: var(--surface-color);
            border: 1px solid var(--border-color);
            border-radius: 16px;
            padding: 2rem;
            transition: all 0.3s ease;
            cursor: pointer;
            position: relative;
            overflow: hidden;
            text-align: left;
        }

        .tool-card:hover {
            transform: translateY(-8px);
            border-color: var(--accent-color);
            box-shadow: 0 0 25px rgba(0,0,0,0.3), 0 0 15px var(--accent-color-trans);
        }

        .tool-icon {
            font-size: 2.5rem;
            margin-bottom: 1.5rem;
            color: var(--accent-color);
            display: flex;
            justify-content: flex-start;
            align-items: center;
        }
        .tool-icon svg {
            width: 40px;
            height: 40px;
            stroke-width: 1.5;
        }

        .tool-title {
            font-size: 1.25rem;
            font-weight: 600;
            margin-bottom: 0.5rem;
            color: var(--text-primary);
        }

        .tool-description {
            font-size: 0.9rem;
            color: var(--text-secondary);
            line-height: 1.5;
        }
        
        /* --- Tooltip Mejorado --- */
        .tooltip {
            position: absolute;
            bottom: 100%;
            left: 50%;
            transform: translateX(-50%) translateY(10px);
            background-color: #000;
            color: #fff;
            padding: 6px 12px;
            border-radius: 6px;
            font-size: 0.8rem;
            font-weight: 500;
            white-space: nowrap;
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.2s ease, transform 0.2s ease;
            pointer-events: none;
            z-index: 10;
            margin-bottom: 8px;
        }

        [onclick]:hover .tooltip, .nav a:hover .tooltip, .window-btn:hover .tooltip, .color-picker-wrapper:hover .tooltip {
            opacity: 1;
            visibility: visible;
            transform: translateX(-50%) translateY(0);
        }

        /* --- Modal Mejorado --- */
        .modal {
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0, 0, 0, 0.7);
            backdrop-filter: blur(8px);
            -webkit-backdrop-filter: blur(8px);
            display: none; justify-content: center; align-items: center;
            z-index: 1000;
            animation: fadeIn 0.3s ease;
        }

        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }

        .modal-content {
            background: var(--bg-color);
            border-radius: 24px;
            padding: 2.5rem;
            max-width: 700px;
            width: 90%;
            max-height: 90vh;
            overflow-y: auto;
            position: relative;
            border: 1px solid var(--border-color);
            box-shadow: 0 25px 50px rgba(0,0,0,0.5);
            animation: scaleUp 0.4s cubic-bezier(0.16, 1, 0.3, 1);
        }

        @keyframes scaleUp { from { transform: scale(0.95); opacity: 0; } to { transform: scale(1); opacity: 1; } }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 2rem;
            padding-bottom: 1.5rem;
            border-bottom: 1px solid var(--border-color);
        }

        .modal-title {
            font-size: 1.75rem;
            font-weight: 700;
            color: var(--accent-color);
            letter-spacing: -0.03em;
        }

        .close-btn {
            background: transparent;
            border: none;
            color: var(--text-secondary);
            font-size: 1.75rem;
            cursor: pointer;
            padding: 5px;
            transition: color 0.3s, transform 0.3s;
            line-height: 1;
        }

        .close-btn:hover {
            color: var(--accent-color);
            transform: rotate(90deg);
        }

        .subtitle {
            color: var(--text-secondary);
            font-size: 1rem;
            margin-bottom: 2rem;
            text-align: left;
            font-weight: 400;
        }

        .tool-list {
            display: flex;
            flex-direction: column;
            gap: 0.75rem;
            margin-top: 1rem;
        }

        .tool-item {
            background: transparent;
            border: 1px solid var(--border-color);
            border-radius: 12px;
            padding: 1rem 1.5rem;
            transition: all 0.2s ease;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .tool-item:hover {
            background: var(--surface-hover);
            border-color: var(--border-hover);
            transform: translateY(-2px);
        }

        .tool-item.selected {
            background: var(--surface-color);
            border-color: var(--accent-color);
            box-shadow: 0 0 15px var(--accent-color-trans);
        }

        .tool-item-content {
            display: flex;
            align-items: center;
            gap: 1.25rem;
            flex: 1;
        }

        .tool-checkbox {
            width: 24px;
            height: 24px;
            border: 2px solid var(--border-color);
            border-radius: 6px;
            background: transparent;
            position: relative;
            transition: all 0.2s ease;
            flex-shrink: 0;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .tool-item.selected .tool-checkbox, .tool-checkbox.checked {
            background: var(--accent-color);
            border-color: var(--accent-color);
        }

        .tool-checkbox.checked::after {
            content: '✔';
            font-size: 16px;
            color: var(--bg-color);
            font-weight: bold;
        }

        .tool-item-text {
            font-size: 1rem;
            font-weight: 500;
            color: var(--text-primary);
            flex: 1;
        }

        .tool-item-arrow {
            color: var(--text-secondary);
            font-size: 1.5rem;
            margin-left: 1rem;
            transition: transform 0.3s;
        }
        .tool-item:hover .tool-item-arrow {
            transform: translateX(5px);
        }

        /* --- FAB Mejorado --- */
        .fab-container {
            position: fixed;
            bottom: 2rem;
            right: 2rem;
            z-index: 1000;
        }

        .fab {
            background: var(--accent-color);
            border: none;
            border-radius: 50%;
            width: 64px;
            height: 64px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #000; /* Color de texto oscuro para contraste */
            cursor: pointer;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.3), 0 0 20px var(--accent-color-trans);
            transition: all 0.3s cubic-bezier(0.16, 1, 0.3, 1);
            text-decoration: none;
            position: relative;
        }

        .fab:hover {
            transform: scale(1.1);
            box-shadow: 0 15px 30px rgba(0, 0, 0, 0.4), 0 0 30px var(--accent-color-trans);
        }
        
        .fab:disabled {
            background: var(--surface-hover);
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
            color: var(--text-secondary);
        }
        
        .fab-icon {
            font-size: 1.75rem;
            transition: transform 0.4s ease;
        }
        .fab-icon svg {
            width: 28px;
            height: 28px;
        }
        
        .fab:hover:not(:disabled) .fab-icon {
            transform: rotate(180deg);
        }

        .fab #fabText {
            font-size: 10px;
            font-weight: 700;
            letter-spacing: 0.05em;
            text-transform: uppercase;
        }

        .fab-count {
            font-size: 1rem;
            font-weight: 700;
            position: absolute;
            top: -5px;
            right: -5px;
            background: var(--bg-color);
            color: var(--accent-color);
            width: 28px;
            height: 28px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            border: 2px solid var(--accent-color);
            transform: scale(0);
            transition: transform 0.3s cubic-bezier(0.34, 1.56, 0.64, 1);
        }
        
        .fab:not(:disabled) .fab-count {
           transform: scale(1);
        }

        /* --- Cajas de Mensajes y Código --- */
        .message-box, .code-display-box {
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0, 0, 0, 0.7);
            backdrop-filter: blur(8px);
            -webkit-backdrop-filter: blur(8px);
            display: none; justify-content: center; align-items: center;
            z-index: 1001;
            animation: fadeIn 0.3s ease;
        }

        .message-box .modal-content, .code-display-box .modal-content {
            border: 1px solid var(--accent-color);
            box-shadow: 0 0 40px var(--accent-color-trans);
        }
        
        .message-box p {
            font-size: 1rem;
            margin-bottom: 2rem;
            color: var(--text-primary);
            line-height: 1.6;
        }

        .message-box button, .code-display-box .actions button {
            background: var(--accent-color);
            border: 1px solid var(--accent-color);
            border-radius: 8px;
            padding: 12px 25px;
            color: #000;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s ease;
            font-family: var(--font-family);
            font-size: 0.9rem;
        }

        .message-box button:hover, .code-display-box .actions button:hover {
            background: transparent;
            color: var(--accent-color);
        }

        .code-display-box .modal-content {
            display: flex;
            flex-direction: column;
            max-width: 800px;
        }

        .code-display-box pre {
            background-color: var(--bg-color);
            color: #f0f0f0;
            padding: 1.5rem;
            border-radius: 12px;
            border: 1px solid var(--border-color);
            overflow-x: auto;
            margin-top: 1rem;
            margin-bottom: 2rem;
            font-family: 'Courier New', Courier, monospace;
            font-size: 0.9rem;
            text-align: left;
            white-space: pre-wrap;
            word-wrap: break-word;
            flex-grow: 1;
            max-height: 50vh;
        }

        .code-display-box .actions {
            display: flex;
            justify-content: flex-end;
            gap: 1rem;
            margin-top: 1rem;
        }
        
        .code-display-box .actions .copy-btn {
            background: var(--surface-hover);
            border-color: var(--border-color);
            color: var(--text-primary);
        }
        .code-display-box .actions .copy-btn:hover {
            background: var(--surface-color);
            border-color: var(--border-hover);
            color: var(--accent-color);
        }

        /* --- Estilos del Modal "Sobre" --- */
        #about-modal .modal-content {
            text-align: center;
        }
        #about-modal img {
            width: 100px;
            height: 100px;
            border-radius: 50%;
            margin-bottom: 1.5rem;
            border: 2px solid var(--border-color);
        }
        #about-modal .info-section {
            background: var(--surface-color);
            border: 1px solid var(--border-color);
            border-radius: 12px;
            padding: 1.5rem;
            margin-bottom: 1rem;
            text-align: left;
        }
        #about-modal .info-section p {
            color: var(--text-primary);
            margin-bottom: 0.5rem;
        }
        #about-modal .info-section p strong {
            color: var(--text-primary);
            font-weight: 600;
        }
        #about-modal .info-section a {
            color: var(--text-secondary);
            text-decoration: none;
            font-weight: 500;
            transition: color 0.3s;
        }
        #about-modal .info-section a:hover {
            text-decoration: underline;
            color: var(--accent-color);
        }

        /* --- Diseño Responsivo --- */
        @media (max-width: 768px) {
            .nav {
                display: none;
            }
            .page-title {
                font-size: 2.5rem;
            }
            .page-subtitle {
                font-size: 1rem;
            }
            .tools-grid {
                grid-template-columns: 1fr;
            }
            .modal-content {
                margin: 1rem;
                width: calc(100% - 2rem);
                padding: 1.5rem;
            }
            .fab-container {
                bottom: 1rem;
                right: 1rem;
            }
            .fab {
                width: 56px;
                height: 56px;
            }
            .fab-icon svg {
                width: 24px;
                height: 24px;
            }
        }
    </style>
</head>
<body>
    <!-- Header -->
    <div class="header">
        <div class="logo">
            <div class="logo-icon"></div>
            <div class="logo-text">
                <h1>TOOLBOXBS</h1>
                <p>By: Brandon Sepulveda</p>
            </div>
        </div>
        <nav class="nav">
            <div class="color-picker-wrapper">
                <label for="colorPicker" title="Cambiar color de acento">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12 2.69l5.66 5.66a8 8 0 1 1-11.31 0z"></path></svg>
                </label>
                <input type="color" id="colorPicker" value="#3b82f6">
                <div class="tooltip">Cambiar Acento</div>
            </div>
            <a href="#" onclick="openModal('home-modal')">Inicio<div class="tooltip">Menú Principal</div></a>
            <a href="#" onclick="openModal('tools-modal')">Herramientas<div class="tooltip">Ver todas las herramientas</div></a>
            <a href="#" onclick="openModal('about-modal')">Sobre<div class="tooltip">Información de la App</div></a>
            <a href="#" onclick="openExternalLink('https://brandonsepulveda.github.io/Documentacion.html')">Documentación<div class="tooltip">Abrir documentación en web</div></a>
        </nav>
        <div class="window-controls">
            <button class="window-btn">–<div class="tooltip">Minimizar</div></button>
            <button class="window-btn">□<div class="tooltip">Maximizar</div></button>
            <button class="window-btn">✕<div class="tooltip">Cerrar</div></button>
        </div>
    </div>

    <!-- Main Content -->
    <div class="main-content" id="mainContent">
        <h1 class="page-title">Tu Caja de Herramientas <span>Digital</span></h1>
        <p class="page-subtitle">Selecciona una categoría para acceder a las utilidades de optimización, reparación y configuración para tu sistema.</p>
        <div class="tools-grid">
            <div class="tool-card" onclick="openModal('info-modal')">
                <div class="tool-icon">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="2" y="2" width="20" height="20" rx="2.18" ry="2.18"></rect><line x1="7" y1="2" x2="7" y2="22"></line><line x1="17" y1="2" x2="17" y2="22"></line><line x1="2" y1="12" x2="22" y2="12"></line><line x1="2" y1="7" x2="7" y2="7"></line><line x1="2" y1="17" x2="7" y2="17"></line><line x1="17" y1="17" x2="22" y2="17"></line><line x1="17" y1="7" x2="22" y2="7"></line></svg>
                </div>
                <div class="tool-title">Info. Sistema</div>
                <div class="tool-description">Datos del hardware y software.</div>
                <div class="tooltip">Ver detalles del sistema</div>
            </div>
            <div class="tool-card" onclick="openExternalLink('https://brandonsepulveda.github.io/apps.html')">
                <div class="tool-icon">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path><polyline points="7 10 12 15 17 10"></polyline><line x1="12" y1="15" x2="12" y2="3"></line></svg>
                </div>
                <h3 class="tool-title">Descargas Apps</h3>
                <p class="tool-description">Instaladores de apps populares.</p>
                <div class="tooltip">Acceder a la página de descargas</div>
            </div>
            <div class="tool-card" onclick="openModal('repair-modal')">
                <div class="tool-icon">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M14.7 6.3a1 1 0 0 0 0 1.4l1.6 1.6a1 1 0 0 0 1.4 0l3.77-3.77a6 6 0 0 1-7.94 7.94l-6.91 6.91a2.12 2.12 0 0 1-3-3l6.91-6.91a6 6 0 0 1 7.94-7.94l-3.76 3.76z"></path></svg>
                </div>
                <div class="tool-title">Reparación</div>
                <div class="tool-description">Verificación y reparación del sistema.</div>
                <div class="tooltip">Ejecutar herramientas de reparación</div>
            </div>
            <div class="tool-card" onclick="openModal('tweaks-modal')">
                <div class="tool-icon">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 0 2l-.15.08a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.38a2 2 0 0 0-.73-2.73l-.15-.08a2 2 0 0 1 0-2l.15-.08a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z"></path><circle cx="12" cy="12" r="3"></circle></svg>
                </div>
                <div class="tool-title">Tweaks</div>
                <div class="tool-description">Utilidades para optimización.</div>
                <div class="tooltip">Aplicar optimizaciones al sistema</div>
            </div>
        </div>
    </div>

    <!-- Floating Action Button -->
    <div class="fab-container">
        <button class="fab" id="fabButton" onclick="showGeneratedCode()" disabled>
            <span class="fab-icon">
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="16 18 22 12 16 6"></polyline><polyline points="8 6 2 12 8 18"></polyline></svg>
            </span>
            <span id="fabText" style="font-weight: 700; display: block;">GENERAR</span>
            <span class="fab-count" id="fabCount" style="transform: scale(0);">0</span>
        </button>
    </div>

    <!-- Modals (estructura HTML sin cambios, solo estilos) -->

    <!-- Modal for Info Sistema -->
    <div id="info-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title">INFORMACIÓN DEL SISTEMA</h2>
                <button class="close-btn" onclick="closeModal('info-modal')">✕</button>
            </div>
            <div class="subtitle">Selecciona la información que deseas ver</div>
            <div class="tool-list">
                <div class="tool-item" onclick="toggleSelection(this, 'info-hardware', 'info')">
                    <div class="tool-item-content">
                        <div class="tool-checkbox"></div>
                        <span class="tool-item-text">Ver Información del Hardware</span>
                    </div>
                    <div class="tooltip">Muestra detalles de CPU, GPU, RAM, etc.</div>
                </div>
                <div class="tool-item" onclick="toggleSelection(this, 'info-software', 'info')">
                    <div class="tool-item-content">
                        <div class="tool-checkbox"></div>
                        <span class="tool-item-text">Ver Información del Software</span>
                    </div>
                    <div class="tooltip">Lista el software instalado y versiones.</div>
                </div>
                <div class="tool-item" onclick="toggleSelection(this, 'info-network', 'info')">
                    <div class="tool-item-content">
                        <div class="tool-checkbox"></div>
                        <span class="tool-item-text">Información de Red</span>
                    </div>
                    <div class="tooltip">Muestra la configuración de red actual.</div>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal for Reparación -->
    <div id="repair-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title">REPARACIÓN Y MANTENIMIENTO</h2>
                <button class="close-btn" onclick="closeModal('repair-modal')">✕</button>
            </div>
            <div class="subtitle">Selecciona una herramienta</div>
            <div class="tool-list">
                <div class="tool-item" onclick="toggleSelection(this, 'create-restore-point', 'repair')">
                    <div class="tool-item-content">
                        <div class="tool-checkbox"></div>
                        <span class="tool-item-text">1. Crear Punto de Restauración</span>
                    </div>
                    <div class="tooltip">Crea un punto de guardado para restaurar el sistema.</div>
                </div>
                <div class="tool-item" onclick="toggleSelection(this, 'os-maintenance', 'repair')">
                    <div class="tool-item-content">
                        <div class="tool-checkbox"></div>
                        <span class="tool-item-text">2. Mantenimiento del S.O.</span>
                    </div>
                    <div class="tooltip">Ejecuta SFC y DISM para reparar archivos del sistema.</div>
                </div>
                <div class="tool-item" onclick="toggleSelection(this, 'bsod-info', 'repair')">
                    <div class="tool-item-content">
                        <div class="tool-checkbox"></div>
                        <span class="tool-item-text">3. Información de Pantallazos Azules</span>
                    </div>
                    <div class="tooltip">Analiza y muestra detalles de errores BSOD anteriores.</div>
                </div>
                <div class="tool-item" onclick="toggleSelection(this, 'battery-status', 'repair')">
                    <div class="tool-item-content">
                        <div class="tool-checkbox"></div>
                        <span class="tool-item-text">4. Ver Estado de la Batería</span>
                    </div>
                    <div class="tooltip">Muestra información detallada sobre la batería.</div>
                </div>
                <div class="tool-item" onclick="toggleSelection(this, 'driver-info', 'repair')">
                    <div class="tool-item-content">
                        <div class="tool-checkbox"></div>
                        <span class="tool-item-text">5. Información de Drivers</span>
                    </div>
                    <div class="tooltip">Lista y gestiona todos los controladores instalados.</div>
                </div>
                <div class="tool-item" onclick="toggleSelection(this, 'repair-network', 'repair')">
                    <div class="tool-item-content">
                        <div class="tool-checkbox"></div>
                        <span class="tool-item-text">6. Reparar Red</span>
                    </div>
                    <div class="tooltip">Soluciona problemas comunes de conectividad de red.</div>
                </div>
                <div class="tool-item" onclick="openModal('cleanup-sub-modal')">
                    <div class="tool-item-content">
                        <span class="tool-item-text">7. Limpieza (Archivos Temporales y RAM)</span>
                    </div>
                    <span class="tool-item-arrow">→</span>
                    <div class="tooltip">Abre opciones de limpieza avanzada.</div>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal for Tweaks -->
    <div id="tweaks-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title">MEJORAS Y UTILIDADES</h2>
                <button class="close-btn" onclick="closeModal('tweaks-modal')">✕</button>
            </div>
            <div class="subtitle">Selecciona una utilidad</div>
            <div class="tool-list">
                <div class="tool-item" onclick="toggleSelection(this, 'winutil', 'tweaks')">
                    <div class="tool-item-content">
                        <div class="tool-checkbox"></div>
                        <span class="tool-item-text">Ejecutar WinUtil</span>
                    </div>
                    <div class="tooltip">Abre la popular herramienta de Chris Titus.</div>
                </div>
                <div class="tool-item" onclick="toggleSelection(this, 'install-winget', 'tweaks')">
                    <div class="tool-item-content">
                        <div class="tool-checkbox"></div>
                        <span class="tool-item-text">Instalar Winget</span>
                    </div>
                    <div class="tooltip">Instala el gestor de paquetes oficial de Microsoft.</div>
                </div>
                <div class="tool-item" onclick="toggleSelection(this, 'activate-windows', 'tweaks')">
                    <div class="tool-item-content">
                        <div class="tool-checkbox"></div>
                        <span class="tool-item-text">Activar Windows</span>
                    </div>
                    <div class="tooltip">Activa Windows usando la clave digital almacenada.</div>
                </div>
                <div class="tool-item" onclick="toggleSelection(this, 'run-optimizer', 'tweaks')">
                    <div class="tool-item-content">
                        <div class="tool-checkbox"></div>
                        <span class="tool-item-text">Ejecutar Optimizer</span>
                    </div>
                    <div class="tooltip">Herramienta de optimización avanzada del sistema.</div>
                </div>
                <div class="tool-item" onclick="toggleSelection(this, 'find-drivers', 'tweaks')">
                    <div class="tool-item-content">
                        <div class="tool-checkbox"></div>
                        <span class="tool-item-text">Buscar Drivers</span>
                    </div>
                    <div class="tooltip">Busca drivers específicos para tu modelo de PC.</div>
                </div>
                <div class="tool-item" onclick="toggleSelection(this, 'update-windows', 'tweaks')">
                    <div class="tool-item-content">
                        <div class="tool-checkbox"></div>
                        <span class="tool-item-text">Actualizar Windows</span>
                    </div>
                    <div class="tooltip">Fuerza la búsqueda de actualizaciones pendientes.</div>
                </div>
                <div class="tool-item" onclick="toggleSelection(this, 'optimize-os', 'tweaks')">
                    <div class="tool-item-content">
                        <div class="tool-checkbox"></div>
                        <span class="tool-item-text">Analizar y Optimizar S.O.</span>
                    </div>
                    <div class="tooltip">Realiza un análisis completo y optimiza el sistema.</div>
                </div>
                <div class="tool-item" onclick="toggleSelection(this, 'system-properties', 'tweaks')">
                    <div class="tool-item-content">
                        <div class="tool-checkbox"></div>
                        <span class="tool-item-text">Propiedades del Sistema</span>
                    </div>
                    <div class="tooltip">Accede a la configuración avanzada del sistema.</div>
                </div>
                <div class="tool-item" onclick="toggleSelection(this, 'disable-transparency', 'tweaks')">
                    <div class="tool-item-content">
                        <div class="tool-checkbox"></div>
                        <span class="tool-item-text">Deshabilitar Transparencia</span>
                    </div>
                    <div class="tooltip">Desactiva efectos de transparencia para mejor rendimiento.</div>
                </div>
                <div class="tool-item" onclick="toggleSelection(this, 'reboot-bios', 'tweaks')">
                    <div class="tool-item-content">
                        <div class="tool-checkbox"></div>
                        <span class="tool-item-text">Apagar y Entrar a BIOS</span>
                    </div>
                    <div class="tooltip">Reinicia el PC y accede directamente a la BIOS/UEFI.</div>
                </div>
                <div class="tool-item" onclick="toggleSelection(this, 'recovery-env', 'tweaks')">
                    <div class="tool-item-content">
                        <div class="tool-checkbox"></div>
                        <span class="tool-item-text">Ingresar al Entorno de Recuperación</span>
                    </div>
                    <div class="tooltip">Accede a las opciones avanzadas de Windows.</div>
                </div>
                <div class="tool-item" onclick="toggleSelection(this, 'update-apps', 'tweaks')">
                    <div class="tool-item-content">
                        <div class="tool-checkbox"></div>
                        <span class="tool-item-text">Actualizar Apps</span>
                    </div>
                    <div class="tooltip">Actualiza todas las aplicaciones instaladas con WinGet.</div>
                </div>
            </div>
        </div>
    </div>

    <!-- Sub-modal for Limpieza (within Reparación) -->
    <div id="cleanup-sub-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title">OPCIONES DE LIMPIEZA</h2>
                <button class="close-btn" onclick="closeModal('cleanup-sub-modal')">✕</button>
            </div>
            <div class="subtitle">Selecciona las opciones de limpieza</div>
            <div class="tool-list">
                <div class="tool-item" onclick="toggleSelection(this, 'cleanup-temp-files', 'repairCleanup')">
                    <div class="tool-item-content">
                        <div class="tool-checkbox"></div>
                        <span class="tool-item-text">Limpiar Archivos Temporales</span>
                    </div>
                    <div class="tooltip">Elimina archivos temporales de Windows y del usuario.</div>
                </div>
                <div class="tool-item" onclick="toggleSelection(this, 'cleanup-optimize-ram', 'repairCleanup')">
                    <div class="tool-item-content">
                        <div class="tool-checkbox"></div>
                        <span class="tool-item-text">Optimizar RAM</span>
                    </div>
                    <div class="tooltip">Libera memoria RAM usando la herramienta RAMMap.</div>
                </div>
            </div>
        </div>
    </div>

    <!-- Message Box -->
    <div id="messageBox" class="message-box">
        <div class="modal-content" style="max-width: 450px; text-align: center;">
            <p id="messageText"></p>
            <button onclick="hideMessageBox()">Cerrar</button>
        </div>
    </div>
    
    <!-- Code Display Box -->
    <div id="codeDisplayBox" class="code-display-box">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title">Script Generado</h2>
                <button class="close-btn" onclick="closeModal('codeDisplayBox')">✕</button>
            </div>
            <pre id="codeContent"></pre>
            <div class="actions">
                <button class="copy-btn" onclick="copyCodeFromDisplay()">Copiar Código</button>
                <button class="download-btn" onclick="downloadZipFromDisplay()">Descargar ZIP</button>
            </div>
        </div>
    </div>

    <!-- Modal for Home (Inicio) -->
    <div id="home-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title">MENÚ DE INICIO</h2>
                <button class="close-btn" onclick="closeModal('home-modal')">✕</button>
            </div>
            <div class="subtitle">Accesos rápidos y herramientas esenciales</div>
            <div class="tool-list">
                <div class="tool-item" onclick="toggleSelection(this, 'home-control-panel', 'home')">
                    <div class="tool-item-content">
                        <div class="tool-checkbox"></div>
                        <span class="tool-item-text">Panel de Control</span>
                    </div>
                    <div class="tooltip">Abre el Panel de Control clásico.</div>
                </div>
                <div class="tool-item" onclick="toggleSelection(this, 'home-quick-diagnostic', 'home')">
                    <div class="tool-item-content">
                        <div class="tool-checkbox"></div>
                        <span class="tool-item-text">Diagnóstico Rápido</span>
                    </div>
                    <div class="tooltip">Realiza una verificación rápida del sistema.</div>
                </div>
                <div class="tool-item" onclick="toggleSelection(this, 'home-windows-settings', 'home')">
                    <div class="tool-item-content">
                        <div class="tool-checkbox"></div>
                        <span class="tool-item-text">Ajustes de Windows</span>
                    </div>
                    <div class="tooltip">Abre la configuración moderna de Windows.</div>
                </div>
                <div class="tool-item" onclick="toggleSelection(this, 'home-file-explorer', 'home')">
                    <div class="tool-item-content">
                        <div class="tool-checkbox"></div>
                        <span class="tool-item-text">Explorador de Archivos</span>
                    </div>
                    <div class="tooltip">Abre el explorador de archivos.</div>
                </div>
                <div class="tool-item" onclick="toggleSelection(this, 'home-powershell-console', 'home')">
                    <div class="tool-item-content">
                        <div class="tool-checkbox"></div>
                        <span class="tool-item-text">PowerShell</span>
                    </div>
                    <div class="tooltip">Abre una terminal de PowerShell.</div>
                </div>
                <div class="tool-item" onclick="toggleSelection(this, 'home-system-info-app', 'home')">
                    <div class="tool-item-content">
                        <div class="tool-checkbox"></div>
                        <span class="tool-item-text">Información del Sistema</span>
                    </div>
                    <div class="tooltip">Muestra información detallada del sistema.</div>
                </div>
                <div class="tool-item" onclick="toggleSelection(this, 'home-install-powershell7', 'home')">
                    <div class="tool-item-content">
                        <div class="tool-checkbox"></div>
                        <span class="tool-item-text">Instalar PowerShell 7</span>
                    </div>
                    <div class="tooltip">Descarga e instala la última versión de PowerShell.</div>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal for Herramientas (Tools) -->
    <div id="tools-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title">MENÚ DE HERRAMIENTAS</h2>
                <button class="close-btn" onclick="closeModal('tools-modal')">✕</button>
            </div>
            <div class="subtitle">Todas las herramientas de optimización y reparación</div>
            <div class="tool-list">
                <div class="tool-item" onclick="toggleSelection(this, 'tools-run-toolboxbs', 'tools')">
                    <div class="tool-item-content">
                        <div class="tool-checkbox"></div>
                        <span class="tool-item-text">Ejecutar ToolboxBS</span>
                    </div>
                    <div class="tooltip">Lanza la versión completa de ToolboxBS en PowerShell.</div>
                </div>
                <div class="tool-item" onclick="toggleSelection(this, 'tools-download-windows', 'tools')">
                    <div class="tool-item-content">
                        <div class="tool-checkbox"></div>
                        <span class="tool-item-text">Descargar Windows</span>
                    </div>
                    <div class="tooltip">Herramienta para descargar imágenes oficiales de Windows.</div>
                </div>
                <div class="tool-item" onclick="toggleSelection(this, 'tools-run-winscript', 'tools')">
                    <div class="tool-item-content">
                        <div class="tool-checkbox"></div>
                        <span class="tool-item-text">Ejecutar WinScript</span>
                    </div>
                    <div class="tooltip">Interfaz de línea de comandos para scripts de Windows.</div>
                </div>
                <div class="tool-item" onclick="toggleSelection(this, 'tools-install-sentinel', 'tools')">
                    <div class="tool-item-content">
                        <div class="tool-checkbox"></div>
                        <span class="tool-item-text">Instalar Sentinel</span>
                    </div>
                    <div class="tooltip">Instala Hard Disk Sentinel para monitoreo del disco duro.</div>
                </div>
                <div class="tool-item" onclick="toggleSelection(this, 'tools-optimize-system', 'tools')">
                    <div class="tool-item-content">
                        <div class="tool-checkbox"></div>
                        <span class="tool-item-text">Optimizar y mejorar el sistema</span>
                    </div>
                    <div class="tooltip">Ejecuta rutinas de optimización automática del sistema.</div>
                </div>
                <div class="tool-item" onclick="toggleSelection(this, 'tools-install-intel-drivers', 'tools')">
                    <div class="tool-item-content">
                        <div class="tool-checkbox"></div>
                        <span class="tool-item-text">Instalar Intel Driver Support</span>
                    </div>
                    <div class="tooltip">Descarga e instala la herramienta de actualización de drivers Intel.</div>
                </div>
                <div class="tool-item" onclick="toggleSelection(this, 'tools-windows-repair', 'tools')">
                    <div class="tool-item-content">
                        <div class="tool-checkbox"></div>
                        <span class="tool-item-text">Reparación de Windows</span>
                    </div>
                    <div class="tooltip">Ejecuta SFC y DISM para reparar archivos corruptos.</div>
                </div>
                <div class="tool-item" onclick="toggleSelection(this, 'tools-task-manager', 'tools')">
                    <div class="tool-item-content">
                        <div class="tool-checkbox"></div>
                        <span class="tool-item-text">Administrador de Tareas</span>
                    </div>
                    <div class="tooltip">Abre el administrador de tareas para gestionar procesos.</div>
                </div>
                <div class="tool-item" onclick="toggleSelection(this, 'tools-device-manager', 'tools')">
                    <div class="tool-item-content">
                        <div class="tool-checkbox"></div>
                        <span class="tool-item-text">Administrador de Dispositivos</span>
                    </div>
                    <div class="tooltip">Gestiona drivers y hardware del sistema.</div>
                </div>
                <div class="tool-item" onclick="toggleSelection(this, 'tools-windows-services', 'tools')">
                    <div class="tool-item-content">
                        <div class="tool-checkbox"></div>
                        <span class="tool-item-text">Servicios</span>
                    </div>
                    <div class="tooltip">Administra y configura servicios de Windows.</div>
                </div>
                <div class="tool-item" onclick="toggleSelection(this, 'tools-disk-cleanup', 'tools')">
                    <div class="tool-item-content">
                        <div class="tool-checkbox"></div>
                        <span class="tool-item-text">Limpieza de Disco</span>
                    </div>
                    <div class="tooltip">Elimina archivos innecesarios para liberar espacio.</div>
                </div>
                <div class="tool-item" onclick="toggleSelection(this, 'tools-registry-editor', 'tools')">
                    <div class="tool-item-content">
                        <div class="tool-checkbox"></div>
                        <span class="tool-item-text">Editor del Registro</span>
                    </div>
                    <div class="tooltip">Edita el registro de Windows (para usuarios avanzados).</div>
                </div>
                <div class="tool-item" onclick="toggleSelection(this, 'tools-winget-cli', 'tools')">
                    <div class="tool-item-content">
                        <div class="tool-checkbox"></div>
                        <span class="tool-item-text">WinGet (CLI)</span>
                    </div>
                    <div class="tooltip">Abre el gestor de paquetes WinGet en PowerShell.</div>
                </div>
                <div class="tool-item" onclick="toggleSelection(this, 'tools-check-updates', 'tools')">
                    <div class="tool-item-content">
                        <div class="tool-checkbox"></div>
                        <span class="tool-item-text">Verificar Actualizaciones</span>
                    </div>
                    <div class="tooltip">Abre Windows Update para buscar actualizaciones.</div>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal for About -->
    <div id="about-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title">SOBRE TOOLBOXBS</h2>
                <button class="close-btn" onclick="closeModal('about-modal')">✕</button>
            </div>
            <img src="https://github.com/BrandonSepulveda/BrandonSepulveda.github.io/blob/main/logo/BS%20ToolBox-03.png?raw=true" alt="Logo de ToolboxBS">
            <h3 style="font-size: 1.5rem; color: #fff; margin-bottom: 10px;">ToolboxBS v2.2</h3>
            <p style="font-size: 1rem; color: var(--text-secondary); line-height: 1.6; max-width: 500px; margin: 0 auto 30px auto;">
                Una colección de herramientas curadas para optimizar, reparar y personalizar tu sistema Windows de forma sencilla y potente.
            </p>
            <div class="info-section">
                <p><strong>Autor:</strong> Jhon Brandon Sepulveda Valdes</p>
                <p><strong>GitHub:</strong> <a href="https://github.com/BrandonSepulveda/ToolboxBS" target="_blank">BrandonSepulveda/ToolboxBS</a></p>
            </div>
            <div class="info-section">
                <p><strong>Licencia:</strong> Licencia: GNU AGPL v3.0 - Copyright (c) 2023-2025 Jhon Brandon Sepulveda Valdes </p>
            </div>
        </div>
    </div>

    <script>
        // ==================================================================
        // INICIO DE LA LÓGICA DE LA APLICACIÓN
        // ==================================================================

        // Objeto para almacenar las herramientas seleccionadas por categoría
        let selectedTools = {
            'info': [],
            'repair': [],
            'repairCleanup': [], // Sub-category for cleanup options
            'tweaks': [],
            'home': [], // New category for Home menu selections
            'tools': [] // New category for Tools menu selections
        };
        
        // Variables globales para almacenar el contenido de los archivos generados
        let currentPs1Content = '';
        let currentBatContent = '';

        // Comandos de PowerShell (Lógica intacta)
        const powershellCommands = {
            'info-hardware': `irm 'https://raw.githubusercontent.com/BrandonSepulveda/ToolboxBS/refs/heads/main/procesos/infosystem.ps1' | iex`,
            'info-software': `irm 'https://raw.githubusercontent.com/BrandonSepulveda/ToolboxBS/refs/heads/main/procesos/infosystem.ps1' | iex`,
            'info-network': `irm 'https://raw.githubusercontent.com/BrandonSepulveda/ToolboxBS/refs/heads/main/procesos/infosystem.ps1' | iex`,
            'create-restore-point': `
                try {
                    Checkpoint-Computer -Description "Punto de restauracion creado por ToolboxBS" -RestorePointType "MODIFY_SETTINGS"
                    Write-Host "Se ha creado un punto de restauracion." -ForegroundColor Green
                } catch {
                    Write-Host "Error al crear punto de restauracion: $_" -ForegroundColor Red
                }
            `,
            'os-maintenance': `
                if (-NOT ([Security.Principal.WindowsPrincipal] [Security.Principal.WindowsIdentity]::GetCurrent()).IsInRole([Security.Principal.WindowsBuiltInRole]::Administrator)) {
                    Write-Host "Debes ejecutar el script como administrador para verificar y reparar archivos del sistema." -ForegroundColor Red
                    exit
                }
                Write-Host "Iniciando mantenimiento de Windows..." -ForegroundColor Green
                $totalRAM = (Get-CimInstance Win32_PhysicalMemory | Measure-Object -Property capacity -Sum).Sum / 1GB
                if ($totalRAM -ge 16) {
                    fsutil behavior set memoryusage 2
                } else {
                    fsutil behavior set memoryusage 1
                }
                bcdedit /set useplatformtick yes
                bcdedit /set disabledynamictick yes
                sfc /scannow
                DISM.exe /Online /Cleanup-image /CheckHealth
                DISM.exe /Online /Cleanup-image /Restorehealth
                sfc /scannow
                Dism.exe /Online /Cleanup-Image /startComponentCleanup
                Write-Host "Mantenimiento completado. ¡Reinicia tu PC para aplicar los cambios!" -ForegroundColor Green
            `,
            'bsod-info': `
                Write-Host "Abriendo BlueScreenView para analizar pantallazos azules..." -ForegroundColor Yellow
                $Url = "https://www.nirsoft.net/utils/bluescreenview.zip"
                $ZipPath = Join-Path $env:TEMP "bluescreenview.zip"
                $ExtractPath = Join-Path $env:TEMP "BlueScreenView"
                try { Invoke-WebRequest -Uri $Url -OutFile $ZipPath } catch { Write-Host "Error al descargar BlueScreenView: $_" -ForegroundColor Red; exit }
                try { Expand-Archive -Path $ZipPath -DestinationPath $ExtractPath -Force } catch { Write-Host "Error al extraer BlueScreenView: $_" -ForegroundColor Red; exit }
                $ExePath = Join-Path $ExtractPath "BlueScreenView.exe"
                if (Test-Path -Path $ExePath) { Start-Process -FilePath $ExePath } else { Write-Host "No se encontro BlueScreenView.exe." -ForegroundColor Red }
                Write-Host "Ejecutando script remoto para mas informacion de pantallazos azules..." -ForegroundColor Yellow
                irm 'https://raw.githubusercontent.com/BrandonSepulveda/ToolboxBS/refs/heads/main/procesos/pantalla%20azul.ps1' | iex
            `,
            'battery-status': `
                Write-Host "Generando informe de bateria..." -ForegroundColor Yellow
                $batteryReportPath = "C:\\battery_report.html"
                powercfg /batteryreport /output "$batteryReportPath"
                if (Test-Path $batteryReportPath) {
                    Start-Process $batteryReportPath
                    Write-Host "Informe de bateria generado en $batteryReportPath" -ForegroundColor Green
                } else {
                    Write-Host "No se pudo generar el informe de bateria." -ForegroundColor Red
                }
                Write-Host "Abriendo BatteryInfoView..." -ForegroundColor Yellow
                $url = "https://www.nirsoft.net/utils/batteryinfoview.zip"
                $outputPath = Join-Path $env:TEMP "BatteryInfoView.zip"
                $extractPath = Join-Path $env:TEMP "BatteryInfoView"
                try { (New-Object System.Net.WebClient).DownloadFile($url, $outputPath) } catch { Write-Host "Error al descargar BatteryInfoView: $_" -ForegroundColor Red; exit }
                try { Expand-Archive -Path $outputPath -DestinationPath $extractPath -Force } catch { Write-Host "Error al extraer BatteryInfoView: $_" -ForegroundColor Red; exit }
                $exePath = Join-Path $extractPath "BatteryInfoView.exe"
                if (Test-Path -Path $exePath) { Start-Process -FilePath $exePath } else { Write-Host "No se encontro BatteryInfoView.exe." -ForegroundColor Red }
            `,
            'driver-info': `
                Write-Host "Exportando informacion de drivers..." -ForegroundColor Yellow
                $outputPath = "C:\\informacion_controladores.txt"
                Get-WmiObject -Query 'SELECT * FROM Win32_SystemDriver' | Select-Object DisplayName, Description, PathName, StartMode, State, Status | Format-List | Out-File -FilePath $outputPath -Encoding UTF8
                Invoke-Item -Path $outputPath
                Write-Host "Informacion de controladores exportada a $outputPath" -ForegroundColor Green
                Start-Process "devmgmt.msc"
            `,
            'repair-network': `
                Write-Host "Reparando red..." -ForegroundColor Yellow
                netsh winsock reset
                netsh int ip reset
                ipconfig /release
                ipconfig /renew
                ipconfig /flushdns
                Write-Host "Reparacion de red completada. Reinicia tu equipo." -ForegroundColor Green
                Start-Process "msdt.exe" -ArgumentList "-id NetworkDiagnostic"
            `,
            'cleanup-temp-files': `
                $userTempPath = $env:TEMP
                $windowsTempPath = "C:\\Windows\\Temp"
                $downloadsTempPath = "C:\\Users\\$env:USERNAME\\Downloads\\Temp"
                $deletedFiles = 0
                $deletedBytes = 0
                function Remove-TempFiles {
                    param([string]$Path, [bool]$SkipInUse = $true)
                    $files = Get-ChildItem -Path $Path -File -ErrorAction SilentlyContinue
                    foreach ($file in $files) {
                        try {
                            if ($SkipInUse -and ($file.IsReadOnly -or $file.InUse)) { continue }
                            Remove-Item $file.FullName -Force -ErrorAction Stop
                            $script:deletedFiles++
                            $script:deletedBytes += $file.Length
                        } catch {}
                    }
                    $folders = Get-ChildItem -Path $Path -Directory -ErrorAction SilentlyContinue
                    foreach ($folder in $folders) {
                        try {
                            if (($folder.GetFiles().Count -eq 0) -and ($folder.GetDirectories().Count -eq 0)) {
                                Remove-Item $folder.FullName -Force -ErrorAction Stop
                            }
                        } catch {}
                    }
                }
                Remove-TempFiles -Path $userTempPath
                if ((New-Object Security.Principal.WindowsPrincipal([Security.Principal.WindowsIdentity]::GetCurrent())).IsInRole([Security.Principal.WindowsBuiltInRole]::Administrator)) {
                    Remove-TempFiles -Path $windowsTempPath -SkipInUse $false
                    if (Test-Path $downloadsTempPath) { Remove-TempFiles -Path $downloadsTempPath }
                }
                Write-Host "Limpieza completada. Archivos eliminados: $deletedFiles, Espacio liberado: $([math]::Round($deletedBytes / 1MB, 2)) MB" -ForegroundColor Green
            `,
            'cleanup-optimize-ram': `
                $zipUrl = "https://download.sysinternals.com/files/RAMMap.zip"
                $downloadPath = "$env:TEMP\\RAMMap.zip"
                $extractPath = "$env:TEMP\\RAMMap"
                try { Invoke-WebRequest -Uri $zipUrl -OutFile $downloadPath } catch { Write-Host "Error al descargar RAMMap: $_" -ForegroundColor Red; exit }
                try { Expand-Archive -Path $downloadPath -DestinationPath $extractPath -Force } catch { Write-Host "Error al descomprimir RAMMap: $_" -ForegroundColor Red; exit }
                $executablePath = Join-Path $extractPath "RAMMap.exe"
                if (Test-Path -Path $executablePath) { Start-Process -FilePath $executablePath } else { Write-Host "No se encontro RAMMap.exe." -ForegroundColor Red }
            `,
            'winutil': `irm christitus.com/win | iex`,
            'install-winget': `Invoke-WebRequest -Uri https://aka.ms/getwinget -OutFile Microsoft.DesktopAppInstaller_8wekyb3d8bbwe.msixbundle; Invoke-WebRequest -Uri https://aka.ms/Microsoft.VCLibs.x64.14.00.Desktop.appx -OutFile Microsoft.VCLibs.x64.14.00.Desktop.appx; Invoke-WebRequest -Uri https://github.com/microsoft/microsoft-ui-xaml/releases/download/v2.7.3/Microsoft.UI.Xaml.2.7.x64.appx -OutFile Microsoft.UI.Xaml.2.7.x64.appx; Add-AppxPackage Microsoft.VCLibs.x64.14.00.Desktop.appx; Add-AppxPackage Microsoft.UI.Xaml.2.7.x64.appx; Add-AppxPackage Microsoft.DesktopAppInstaller_8wekyb3d8bbwe.msixbundle`,
            'activate-windows': `
                $clave = (Get-WmiObject SoftwareLicensingService | Select-Object -ExpandProperty OA3xOriginalProductKey)
                Write-Host "La clave digital es: $clave"
                slmgr.vbs /ipk $clave
                Write-Host "Clave establecida como predefinida correctamente." -ForegroundColor Green
            `,
            'run-optimizer': `
                $url = "https://github.com/hellzerg/optimizer/releases/download/16.7/Optimizer-16.7.exe"
                $outputFolder = "C:\\ToolboxBS"
                $outputPath = Join-Path $outputFolder "Optimizer-16.7.exe"
                if (-not (Test-Path -Path $outputFolder -PathType Container)) { New-Item -ItemType Directory -Force -Path $outputFolder | Out-Null }
                try { Invoke-WebRequest -Uri $url -OutFile $outputPath } catch { Write-Host "Error al descargar Optimizer: $_" -ForegroundColor Red; exit }
                try { Start-Process -FilePath $outputPath } catch { Write-Host "Error al ejecutar Optimizer: $_" -ForegroundColor Red }
            `,
           'find-drivers': `
# =========================================================================
# SCRIPT DE BÚSQUEDA AUTOMÁTICA DE DRIVERS POR FABRICANTE
# =========================================================================

# --- FUNCIONES AUXILIARES ---

function Ensure-Winget {
    if (-not (Get-Command winget -ErrorAction SilentlyContinue)) {
        Write-Host "Winget no encontrado. Intentando instalarlo..." -ForegroundColor Cyan
        try {
            $wingetUrl = "https://github.com/microsoft/winget-cli/releases/latest/download/Microsoft.DesktopAppInstaller_8wekyb3d8bbwe.msixbundle"
            $wingetInstaller = Join-Path $env:TEMP "winget.msixbundle"
            Invoke-WebRequest -Uri $wingetUrl -OutFile $wingetInstaller -UseBasicParsing
            Add-AppxPackage -Path $wingetInstaller
            Write-Host "Winget instalado correctamente." -ForegroundColor Green
        } catch {
            Write-Error "Falló la instalación de Winget: $($_.Exception.Message)"
            return $false
        }
    }
    return $true
}

function Ensure-Chocolatey {
    if (-not (Get-Command choco -ErrorAction SilentlyContinue)) {
        Write-Host "Chocolatey no encontrado. Intentando instalarlo..." -ForegroundColor Cyan
        try {
            Set-ExecutionPolicy Bypass -Scope Process -Force;
            [System.Net.ServicePointManager]::SecurityProtocol = [System.Net.ServicePointManager]::SecurityProtocol -bor 3072;
            iex ((New-Object System.Net.WebClient).DownloadString('https://community.chocolatey.org/install.ps1'))
            Write-Host "Chocolatey instalado correctamente." -ForegroundColor Green
        } catch {
            Write-Error "Falló la instalación de Chocolatey: $($_.Exception.Message)"
            return $false
        }
    }
    return $true
}

function Start-Application {
    param($path, $name)
    Write-Host "Iniciando '$name'..." -ForegroundColor Yellow
    Start-Process -FilePath $path
    Write-Host "¡Proceso completado!" -ForegroundColor Green
    Write-Host "Script finalizado."
    Start-Sleep -Seconds 10
    Exit
}


# --- LÓGICA PRINCIPAL ---

# 1. DETECTAR EL FABRICANTE DEL EQUIPO
try {
    $fabricante = (Get-CimInstance -ClassName Win32_ComputerSystem).Manufacturer
    Write-Host "Fabricante detectado: $fabricante" -ForegroundColor Cyan
}
catch {
    Write-Error "No se pudo detectar el fabricante del equipo."
    Start-Sleep -Seconds 10
    Exit
}

# 2. DEFINIR VARIABLES POR FABRICANTE
$appExePath = ""
switch ($fabricante.Trim().ToLower()) {
    { $_ -like "*dell*" } {
        $appName = "Dell Command | Update"
        $appExePath = "C:\\Program Files\\Dell\\CommandUpdate\\DCU.Client.Gui.exe"
        $wingetId = "Dell.CommandUpdate"
        $chocoId = "dell-command-update"
    }
    { $_ -like "*hp*" -or $_ -like "*hewlett-packard*" } {
        $appName = "HP Image Assistant"
        $appExePath = "C:\\Program Files (x86)\\HP\\Image Assistant\\HPImageAssistant.exe"
        $wingetId = "HP.ImageAssistant"
    }
    { $_ -like "*lenovo*" } {
        $appName = "Lenovo System Update"
        $appExePath = "C:\\Program Files (x86)\\Lenovo\\System Update\\tvsu.exe"
        $wingetId = "Lenovo.SystemUpdate"
        $chocoId = "lenovo-system-update"
    }
    default {
        Write-Warning "El fabricante '$fabricante' no tiene una herramienta de actualización automática soportada por este script."
        Write-Host "Se abrirá una búsqueda en Google para encontrar los drivers manualmente."
        $modelo = (Get-WmiObject -Class:Win32_ComputerSystem).Model
        $serial = (Get-WmiObject -Class:Win32_BIOS).SerialNumber
        Write-Host "Tu equipo es: $modelo, Numero de serie: $serial"
        $url = "https://www.google.com/search?q=$($modelo.replace(' ','+'))+$($serial)+drivers"
        Start-Process $url
        Start-Sleep -Seconds 10
        Exit
    }
}

# 3. PROCESO DE INSTALACIÓN Y EJECUCIÓN
try {
    # Si ya está instalado, ejecutar y salir.
    if (Test-Path $appExePath) {
        Write-Host "'$appName' ya se encuentra instalado." -ForegroundColor Green
        Start-Application -path $appExePath -name $appName
    }

    Write-Host "'$appName' no está instalado. Iniciando proceso de instalación..." -ForegroundColor Yellow

    # --- Intento 1: Winget (Preferido) ---
    if (Ensure-Winget) {
        Write-Host "Intentando instalar con Winget..." -ForegroundColor Cyan
        winget source update | Out-Null
        winget install --id $wingetId -e --accept-package-agreements --accept-source-agreements
        Write-Host "Esperando 15 segundos para que finalice la instalación..."
        Start-Sleep -Seconds 15
        if (Test-Path $appExePath) {
            Write-Host "Instalación con Winget exitosa." -ForegroundColor Green
            Start-Application -path $appExePath -name $appName
        }
    }

    # --- Intento 2: Chocolatey (Respaldo, excepto para HP) ---
    if ($fabricante.Trim().ToLower() -notlike "*hp*") {
        if (Ensure-Chocolatey) {
            Write-Host "Intentando instalar con Chocolatey..." -ForegroundColor Cyan
            choco install $chocoId -y
            Write-Host "Esperando 15 segundos para que finalice la instalación..."
            Start-Sleep -Seconds 15
            if (Test-Path $appExePath) {
                Write-Host "Instalación con Chocolatey exitosa." -ForegroundColor Green
                Start-Application -path $appExePath -name $appName
            }
        }
    }

    # --- Intento 3: Descarga Manual (Último recurso para HP y Lenovo) ---
    Write-Host "Los métodos automáticos fallaron. Intentando descarga manual..." -ForegroundColor Cyan
    $downloadUrl = ""
    $installerName = ""
    $installArgs = ""
    
    if ($fabricante.Trim().ToLower() -like "*hp*") {
        $downloadUrl = "https://hpia.hpcloud.hp.com/downloads/hpia/hp-hpia-5.3.2.exe"
        $installerName = "HPIA_Extractor.exe"
        $installArgs = "/s" # Argumento para extracción silenciosa
    } elseif ($fabricante.Trim().ToLower() -like "*lenovo*") {
        $downloadUrl = "https://download.lenovo.com/pccbbs/thinkvantage_en/system_update_5.08.02.25.exe"
        $installerName = "LenovoSystemUpdate.exe"
        $installArgs = "/VERYSILENT /SUPPRESSMSGBOXES /NORESTART"
    }

    if ($downloadUrl) {
        $installerPath = Join-Path $env:TEMP $installerName
        Invoke-WebRequest -Uri $downloadUrl -OutFile $installerPath
        Write-Host "Instalando con argumentos: $installArgs" -ForegroundColor Gray
        Start-Process -FilePath $installerPath -ArgumentList $installArgs -Wait
        Write-Host "Esperando 15 segundos para que finalice la instalación..."
        Start-Sleep -Seconds 15

        # Lógica especial para HP: Buscar el ejecutable en C:\\SWSetup
        if ($fabricante.Trim().ToLower() -like "*hp*") {
            Write-Host "Buscando el ejecutable de HP Image Assistant en C:\\SWSetup..."
            $searchPath = "C:\\SWSetup"
            if (Test-Path $searchPath) {
                $hpiaExecutable = Get-ChildItem -Path $searchPath -Recurse -Filter "HPImageAssistant.exe" | Select-Object -First 1
                if ($hpiaExecutable) {
                    $appExePath = $hpiaExecutable.FullName # Ruta encontrada dinámicamente
                    Write-Host "Ejecutable encontrado en: $appExePath" -ForegroundColor Green
                }
            }
        }

        if (Test-Path $appExePath) {
            Write-Host "Instalación manual exitosa." -ForegroundColor Green
            Start-Application -path $appExePath -name $appName
        }
    }
    
    # Si el script llega hasta aquí, significa que todo falló.
    Write-Error "Todos los métodos de instalación fallaron para '$appName'."
    Start-Sleep 10
    Exit
}
catch {
    Write-Error "Ocurrió un error inesperado: $($_.Exception.Message)"
}

Write-Host "Script finalizado."
Start-Sleep -Seconds 10
`,
            'update-windows': `Start-Process "C:\\Windows\\System32\\UsoClient.exe" -ArgumentList "StartInteractiveScan"`,
            'optimize-os': `irm 'https://raw.githubusercontent.com/BrandonSepulveda/ToolboxBS/refs/heads/main/procesos/Analizador.ps1' | iex`,
            'system-properties': `control.exe sysdm.cpl`,
            'disable-transparency': `
                $registryPath = "HKCU:\\SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\Themes\\Personalize"
                Set-ItemProperty -Path $registryPath -Name "EnableTransparency" -Value 0
                Write-Host "Transparencia deshabilitada correctamente." -ForegroundColor Green
            `,
            'reboot-bios': `
                $result = [System.Windows.MessageBox]::Show("Se apagara el sistema y entrara a la BIOS. Desea continuar?", "Confirmar", [System.Windows.MessageBoxButton]::YesNo, [System.Windows.MessageBoxImage]::Question)
                if ($result -eq 'Yes') { shutdown /r /fw /t 1 }
            `,
            'recovery-env': `
                $result = [System.Windows.MessageBox]::Show("Se reiniciara el sistema y entrara al entorno de recuperacion. Desea continuar?", "Confirmar", [System.Windows.MessageBoxButton]::YesNo, [System.Windows.MessageBoxImage]::Question)
                if ($result -eq 'Yes') { shutdown /r /o /f /t 00 }
            `,
            'update-apps': `winget update --all`,
            'home-control-panel': `Start-Process "control.exe"`,
            'home-quick-diagnostic': `
                $diagnosticReport = New-Object System.Text.StringBuilder
                $diagnosticReport.AppendLine("DIAGNÓSTICO RÁPIDO DEL SISTEMA") | Out-Null
                $diagnosticReport.AppendLine("=============================") | Out-Null
                $diagnosticReport.AppendLine("") | Out-Null
                $criticalDrives = Get-WmiObject -Class Win32_LogicalDisk -Filter "DriveType=3" | Where-Object { ($_.FreeSpace / $_.Size) -lt 0.1 }
                if ($criticalDrives) {
                    $diagnosticReport.AppendLine("⚠️ ALERTA: Poco espacio en disco") | Out-Null
                    foreach ($drive in $criticalDrives) {
                        $freeGB = [Math]::Round($drive.FreeSpace / 1GB, 2)
                        $totalGB = [Math]::Round($drive.Size / 1GB, 2)
                        $percentFree = [Math]::Round(($drive.FreeSpace / $drive.Size) * 100, 1)
                        $diagnosticReport.AppendLine("   Unidad $($drive.DeviceID): $freeGB GB libres de $totalGB GB ($percentFree% libre)") | Out-Null
                    }
                    $diagnosticReport.AppendLine("") | Out-Null
                }
                $os = Get-WmiObject -Class Win32_OperatingSystem
                $memoryUsage = [Math]::Round((($os.TotalVisibleMemorySize - $os.FreePhysicalMemory) / $os.TotalVisibleMemorySize) * 100, 1)
                if ($memoryUsage -gt 80) {
                    $diagnosticReport.AppendLine("⚠️ ALERTA: Alto uso de memoria") | Out-Null
                    $diagnosticReport.AppendLine("   Uso actual: $memoryUsage%") | Out-Null
                    $diagnosticReport.AppendLine("") | Out-Null
                }
                $criticalServices = @("wuauserv", "WinDefend", "MpsSvc")
                $serviceStatus = @()
                foreach ($service in $criticalServices) {
                    $svc = Get-Service -Name $service -ErrorAction SilentlyContinue
                    if ($svc -and $svc.Status -ne "Running") {
                        $serviceStatus += "$($svc.DisplayName) ($($svc.Status))"
                    }
                }
                if ($serviceStatus.Count -gt 0) {
                    $diagnosticReport.AppendLine("⚠️ ALERTA: Servicios criticos detenidos") | Out-Null
                    foreach ($status in $serviceStatus) {
                        $diagnosticReport.AppendLine("   $status") | Out-Null
                    }
                    $diagnosticReport.AppendLine("") | Out-Null
                }
                try {
                    $updateSession = New-Object -ComObject Microsoft.Update.Session
                    $updateSearcher = $updateSession.CreateUpdateSearcher()
                    $pendingUpdates = $updateSearcher.Search("IsInstalled=0").Updates.Count
                    if ($pendingUpdates -gt 0) {
                        $diagnosticReport.AppendLine("⚠️ AVISO: Actualizaciones pendientes") | Out-Null
                        $diagnosticReport.AppendLine("   Hay $pendingUpdates actualizaciones pendientes") | Out-Null
                        $diagnosticReport.AppendLine("") | Out-Null
                    }
                } catch {}
                try {
                    $criticalEvents = Get-WinEvent -LogName System -MaxEvents 50 | Where-Object { $_.Level -eq 1 -or $_.Level -eq 2 } | Select-Object -First 5
                    if ($criticalEvents.Count -gt 0) {
                        $diagnosticReport.AppendLine("⚠️ ALERTA: Eventos criticos recientes") | Out-Null
                        foreach ($event in $criticalEvents) {
                            $eventTime = $event.TimeCreated.ToString("dd/MM/yyyy HH:mm")
                            $diagnosticReport.AppendLine("   $eventTime - ID: $($event.Id) - $($event.ProviderName)") | Out-Null
                        }
                        $diagnosticReport.AppendLine("") | Out-Null
                    }
                } catch {}
                if ($diagnosticReport.Length -eq 81) {
                    $diagnosticReport.AppendLine("✓ No se encontraron problemas criticos") | Out-Null
                    $diagnosticReport.AppendLine("  El sistema parece estar funcionando correctamente") | Out-Null
                }
                $diagnosticReport.AppendLine("") | Out-Null
                $diagnosticReport.AppendLine("RECOMENDACIONES:") | Out-Null
                $diagnosticReport.AppendLine("- Para un analisis completo, use la funcion Info. Sistema") | Out-Null
                $diagnosticReport.AppendLine("- Ejecute regularmente la funcion Mantenimiento del S.O.") | Out-Null
                Write-Host $diagnosticReport.ToString()
            `,
            'home-windows-settings': `Start-Process "ms-settings:"`,
            'home-file-explorer': `Start-Process "explorer.exe"`,
            'home-powershell-console': `
                $pwsh7Path = (Get-Command "pwsh" -ErrorAction SilentlyContinue).Source
                if ($pwsh7Path) { Start-Process $pwsh7Path } else { Start-Process "powershell.exe" }
            `,
            'home-system-info-app': `Start-Process "msinfo32.exe"`,
            'home-install-powershell7': `
                $pwsh7Path = (Get-Command "pwsh" -ErrorAction SilentlyContinue).Source
                if ($pwsh7Path) {
                    Write-Host "PowerShell 7 ya esta instalado en: $pwsh7Path\`n\`nVersion: $((Get-Command pwsh).Version)" -ForegroundColor Green
                    exit
                }
                $currentPrincipal = New-Object Security.Principal.WindowsPrincipal([Security.Principal.WindowsIdentity]::GetCurrent())
                $isAdmin = $currentPrincipal.IsInRole([Security.Principal.WindowsBuiltInRole]::Administrator)
                if (-not $isAdmin) {
                    Write-Host "Se requieren permisos de administrador para instalar PowerShell 7." -ForegroundColor Red
                    exit
                }
                $wingetInstalled = $null -ne (Get-Command winget -ErrorAction SilentlyContinue)
                if ($wingetInstalled) {
                    Write-Host "Intentando instalar PowerShell 7 con Winget..." -ForegroundColor Cyan
                    $process = Start-Process winget -ArgumentList "install", "Microsoft.PowerShell", "--accept-source-agreements", "--accept-package-agreements", "-h" -PassThru -Wait
                    if ($process.ExitCode -eq 0) { Write-Host "PowerShell 7 instalado correctamente." -ForegroundColor Green }
                    else { Write-Host "Error al instalar PowerShell 7 con Winget. Codigo de salida: " + $process.ExitCode -ForegroundColor Red }
                } else {
                    Write-Host "Winget no disponible. Descargando instalador MSI..." -ForegroundColor Yellow
                    $msiUrl = "https://github.com/PowerShell/PowerShell/releases/download/v7.3.9/PowerShell-7.3.9-win-x64.msi"
                    $msiPath = "$env:TEMP\\PowerShell-7-win-x64.msi"
                    try { Invoke-WebRequest -Uri $msiUrl -OutFile $msiPath } catch { Write-Host "Error al descargar o instalar PowerShell 7: $_" -ForegroundColor Red; exit }
                    $process = Start-Process msiexec -ArgumentList "/i \`"$msiPath\`" /qn /norestart" -PassThru -Wait
                    if ($process.ExitCode -eq 0 -or $process.ExitCode -eq 3010) { Write-Host "PowerShell 7 instalado correctamente." -ForegroundColor Green }
                    else { Write-Host "Error al instalar PowerShell 7. Codigo de salida: " + $process.ExitCode -ForegroundColor Red }
                }
            `,
            'tools-run-toolboxbs': `irm https://brandonsepulveda.github.io/Tool | iex`,
            'tools-download-windows': `irm https://raw.githubusercontent.com/BrandonSepulveda/ToolboxBS/refs/heads/main/procesos/windows%20instalador.ps1 | iex`,
            'tools-run-winscript': `irm https://winscript.cc/irm | iex`,
            'tools-install-sentinel': `
                $downloadURL = "https://www.harddisksentinel.com/hdsentinel_pro_portable.zip"
                $downloadPath = [System.IO.Path]::Combine($env:TEMP, "HDSentinel.zip")
                $extractPath = [System.IO.Path]::Combine($env:TEMP, "HDSentinel")
                if (-not (Test-Path -Path $extractPath)) { New-Item -Path $extractPath -ItemType Directory -Force | Out-Null }
                Write-Host "Descargando Hard Disk Sentinel..." -ForegroundColor Yellow
                try {
                    $ProgressPreference = 'Continue'
                    Invoke-WebRequest -Uri $downloadURL -OutFile $downloadPath -UseBasicParsing
                } catch { Write-Host "Error al descargar Hard Disk Sentinel: $_" -ForegroundColor Red; exit }
                Write-Host "Extrayendo archivos..." -ForegroundColor Yellow
                try {
                    Add-Type -AssemblyName System.IO.Compression.FileSystem
                    [System.IO.Compression.ZipFile]::ExtractToDirectory($downloadPath, $extractPath)
                } catch { Write-Host "Error al extraer los archivos: $_" -ForegroundColor Red; exit }
                $hdSentinelExe = Get-ChildItem -Path $extractPath -Recurse -Filter "HDSentinel.exe" | Select-Object -First 1
                if ($hdSentinelExe) {
                    Write-Host "Ejecutando Hard Disk Sentinel..." -ForegroundColor Yellow
                    try { Start-Process -FilePath $hdSentinelExe.FullName -Wait } catch { Write-Host "Error al ejecutar Hard Disk Sentinel: $_" -ForegroundColor Red; exit }
                } else { Write-Host "No se encontro el ejecutable HDSentinel.exe." -ForegroundColor Red }
                Write-Host "Limpiando archivos temporales..." -ForegroundColor Yellow
                try {
                    Remove-Item -Path $downloadPath -Force -ErrorAction SilentlyContinue
                    Remove-Item -Path $extractPath -Recurse -Force -ErrorAction SilentlyContinue
                } catch { Write-Host "Error al eliminar archivos temporales: $_" -ForegroundColor Red }
            `,
            'tools-optimize-system': `
                if (-not (Test-Path "$env:TEMP\\ToolboxBS")) { New-Item -Path "$env:TEMP\\ToolboxBS" -ItemType Directory -Force -ErrorAction SilentlyContinue | Out-Null }
                Invoke-WebRequest -Uri "https://raw.githubusercontent.com/BrandonSepulveda/ToolboxBS/refs/heads/main/procesos/performance.bat" -OutFile "$env:TEMP\\ToolboxBS\\performance.bat"
                Start-Process -FilePath "cmd.exe" -ArgumentList "/c", "$env:TEMP\\ToolboxBS\\performance.bat"
            `,
            'tools-install-intel-drivers': `
                Write-Host "Descargando Intel Driver Support Assistant..." -ForegroundColor Yellow
                $downloadPath = Join-Path $env:TEMP "IntelDriverSupport.exe"
                try {
                    Invoke-WebRequest -Uri "https://dsadata.intel.com/installer" -OutFile $downloadPath
                    if (Test-Path $downloadPath) {
                        Write-Host "Iniciando instalacion..." -ForegroundColor Green
                        Start-Process -FilePath $downloadPath -Wait
                        Write-Host "Eliminando archivos temporales..." -ForegroundColor Yellow
                        Remove-Item -Path $downloadPath -Force
                        Write-Host "Instalacion completada y archivos temporales eliminados." -ForegroundColor Green
                    } else { Write-Host "Error: No se pudo descargar el instalador" -ForegroundColor Red }
                } catch { Write-Host "Error: $_" -ForegroundColor Red }
            `,
            'tools-windows-repair': `sfc /scannow; DISM.exe /Online /Cleanup-image /Restorehealth`,
            'tools-task-manager': `Start-Process "taskmgr.exe"`,
            'tools-device-manager': `Start-Process "devmgmt.msc"`,
            'tools-windows-services': `Start-Process "services.msc"`,
            'tools-disk-cleanup': `Start-Process "cleanmgr.exe"`,
            'tools-registry-editor': `Start-Process "regedit.exe"`,
            'tools-winget-cli': `Start-Process powershell -ArgumentList "-NoExit", "-Command", "winget"`,
            'tools-check-updates': `Start-Process "ms-settings:windowsupdate"`
        };

        // Función para alternar la selección de un elemento
        function toggleSelection(element, toolId, category) {
            const checkbox = element.querySelector('.tool-checkbox');
            const isSelected = element.classList.contains('selected');
            
            if (isSelected) {
                element.classList.remove('selected');
                if (checkbox) checkbox.classList.remove('checked');
                selectedTools[category] = selectedTools[category].filter(id => id !== toolId);
            } else {
                element.classList.add('selected');
                if (checkbox) checkbox.classList.add('checked');
                selectedTools[category].push(toolId);
            }
            
            updateGlobalFloatingButton(); // Update global button on any selection change
        }

        // Función para actualizar el estado del botón de ejecución y el contador
        function updateGlobalFloatingButton() {
            let totalSelected = 0;
            let selectedTitles = [];
            for (const category in selectedTools) {
                totalSelected += selectedTools[category].length;
                selectedTools[category].forEach(toolId => {
                    const toolItem = document.querySelector(`.tool-item[onclick*="'${toolId}'"]`);
                    if(toolItem) {
                        selectedTitles.push(toolItem.querySelector('.tool-item-text').textContent.trim());
                    }
                });
            }
            
            const fabButton = document.getElementById('fabButton');
            const fabCount = document.getElementById('fabCount');
            const fabText = document.getElementById('fabText');

            fabButton.disabled = totalSelected === 0;
            
            if (totalSelected > 0) {
                fabCount.textContent = totalSelected;
                fabButton.title = 'Generar Script (' + totalSelected + ' seleccionados)';
                fabText.style.display = 'none';
                fabCount.style.transform = 'scale(1)';
            } else {
                fabButton.title = 'Generar Script';
                fabText.style.display = 'block';
                fabCount.style.transform = 'scale(0)';
            }
        }

        // Función para limpiar todas las selecciones de una categoría específica
        function clearSelections(category) {
            selectedTools[category] = [];
            const modalId = getModalIdFromCategory(category);
            const modal = document.getElementById(modalId);
            if (modal) {
                const items = modal.querySelectorAll('.tool-item');
                items.forEach(item => {
                    item.classList.remove('selected');
                    const checkbox = item.querySelector('.tool-checkbox');
                    if (checkbox) checkbox.classList.remove('checked');
                });
            }
            updateGlobalFloatingButton();
        }

        // Función para obtener el ID del modal a partir de la categoría
        function getModalIdFromCategory(category) {
            switch(category) {
                case 'info': return 'info-modal';
                case 'repair': return 'repair-modal';
                case 'repairCleanup': return 'cleanup-sub-modal';
                case 'tweaks': return 'tweaks-modal';
                case 'home': return 'home-modal';
                case 'tools': return 'tools-modal';
                case 'about': return 'about-modal';
                default: return '';
            }
        }

        // Función para mostrar el código generado y descargar ZIP
        function showGeneratedCode() {
            const allCommands = [];
            let hasSelections = false;
            for (const category in selectedTools) {
                for (const toolId of selectedTools[category]) {
                    const command = powershellCommands[toolId];
                    if (command) {
                        const toolItem = document.querySelector(`.tool-item[onclick*="'${toolId}'"]`);
                        const toolText = toolItem ? toolItem.querySelector('.tool-item-text').textContent.trim() : `Tarea`;
                        allCommands.push({ text: toolText, script: command });
                        hasSelections = true;
                    }
                }
            }

            if (!hasSelections) {
                showMessageBox("Por favor, selecciona al menos una función para generar el script.");
                return;
            }

            let ps1Header = `<#
    .SYNOPSIS
        Script de automatización generado por ToolboxBS.

    .DESCRIPTION
        Este script ejecuta una serie de tareas de mantenimiento y optimización seleccionadas
        a través de la interfaz web de ToolboxBS.

    .WARNING
        Este script realiza cambios en el sistema. Ha sido generado basado en tus selecciones.
        Ejecútalo únicamente si confías en la fuente (ToolboxBS) y entiendes las tareas que se realizarán.
        Los programas antivirus pueden marcar este archivo como potencialmente peligroso debido a las
        acciones administrativas que realiza. Esto es, en la mayoría de los casos, un falso positivo.
#>\n\n`;
            
            let ps1Content = ps1Header + `# =================================================================\n`;
            ps1Content += `# INICIO DEL SCRIPT GENERADO POR TOOLBOXBS\n`;
            ps1Content += `# =================================================================\n\n`;

            allCommands.forEach((cmd, index) => {
                ps1Content += `Write-Host ""\n`;
                ps1Content += `Write-Host "=================================================================" -ForegroundColor Green\n`;
                ps1Content += `Write-Host "        EJECUTANDO TAREA ${index + 1}/${allCommands.length}: ${cmd.text}" -ForegroundColor Yellow\n`;
                ps1Content += `Write-Host "=================================================================" -ForegroundColor Green\n\n`;
                ps1Content += `${cmd.script.trim()}\n\n`;
            });
            ps1Content += `Write-Host "Todas las tareas han finalizado." -ForegroundColor Green\n`;
            ps1Content += `Read-Host "Presiona ENTER para continuar con la limpieza de archivos."\n`;

            let batContent = `@echo off
REM =================================================================
REM LANZADOR PARA EL SCRIPT DE TOOLBOXBS (CON AUTODESTRUCCIÓN)
REM =================================================================
REM Este archivo .bat está diseñado para ejecutar el script 'ToolboxBS_Script.ps1'
REM con la política de ejecución correcta y luego se limpiará a sí mismo.
REM
REM ADVERTENCIA DE SEGURIDAD:
REM Su navegador o antivirus puede marcar este archivo como peligroso.
REM Esto es normal para scripts que realizan tareas administrativas.
REM Ejecútelo solo si confía en la fuente.
REM
REM Para ejecutar, haga clic derecho sobre este archivo y seleccione
REM "Ejecutar como administrador".
REM =================================================================

chcp 65001 > nul
echo Ejecutando el script de PowerShell...
powershell.exe -NoProfile -ExecutionPolicy Bypass -File "%~dp0ToolboxBS_Script.ps1"

echo.
echo Creando script de limpieza temporal...

REM Crea un script de limpieza en la carpeta temporal del sistema.
>"%TEMP%\\cleanup_toolbox.bat" echo @echo off
>>"%TEMP%\\cleanup_toolbox.bat" echo echo.
>>"%TEMP%\\cleanup_toolbox.bat" echo echo Limpiando archivos de ToolboxBS...
>>"%TEMP%\\cleanup_toolbox.bat" echo timeout /t 4 /nobreak > nul
>>"%TEMP%\\cleanup_toolbox.bat" echo rmdir /s /q "%~dp0"
>>"%TEMP%\\cleanup_toolbox.bat" echo echo Limpieza completada. La ventana se cerrara en 2 segundos.
>>"%TEMP%\\cleanup_toolbox.bat" echo timeout /t 2 /nobreak > nul
>>"%TEMP%\\cleanup_toolbox.bat" echo del "%%~f0"

echo Lanzando limpieza en segundo plano y saliendo...
start "" /b cmd /c "%TEMP%\\cleanup_toolbox.bat"
`;

            currentPs1Content = ps1Content;
            currentBatContent = batContent;

            document.getElementById('codeContent').textContent = ps1Content;
            openModal('codeDisplayBox');
        }

        function copyCodeFromDisplay() {
            const codeContent = document.getElementById('codeContent').textContent;
            navigator.clipboard.writeText(codeContent).then(() => {
                showMessageBox("¡Código copiado al portapapeles!");
            }, (err) => {
                console.error('Error al copiar: ', err);
                showMessageBox("Error al copiar el código.");
            });
        }

        async function downloadZipFromDisplay() {
            try {
                const zip = new JSZip();
                zip.file("ToolboxBS_Script.ps1", currentPs1Content);
                zip.file("EJECUTAR_ESTE_ARCHIVO.bat", currentBatContent);
                
                const zipBlob = await zip.generateAsync({ type: "blob" });

                const url = URL.createObjectURL(zipBlob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `ToolboxBS_Script.zip`;
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                URL.revokeObjectURL(url);
                
                closeModal('codeDisplayBox');

                showMessageBox("<h3 style='color: var(--accent-color);'>¡ZIP generado!</h3><p style='text-align: left; margin-bottom: 15px;'><strong>ADVERTENCIA DE SEGURIDAD:</strong><br>Tu navegador o antivirus podría marcar el archivo descargado como peligroso. Esto es normal para herramientas de sistema.</p><p style='text-align: left;'><strong>Pasos para ejecutar:</strong><br>1. Extrae el contenido del archivo <strong>ToolboxBS_Script.zip</strong>.<br>2. Dentro de la carpeta, haz clic derecho en <strong>EJECUTAR_ESTE_ARCHIVO.bat</strong>.<br>3. Selecciona '<strong>Ejecutar como administrador</strong>'.</p>");

            } catch (error) {
                console.error("Error al generar el ZIP:", error);
                showMessageBox("Ocurrió un error al generar el archivo ZIP.");
            }

            // Limpiar selecciones
            for (const category in selectedTools) {
                clearSelections(category);
            }
            updateGlobalFloatingButton();
        }

        // Funciones para abrir y cerrar modales
        function openModal(modalId) {
            const modal = document.getElementById(modalId);
            if (modal) modal.style.display = 'flex';
        }

        function closeModal(modalId) {
            const modal = document.getElementById(modalId);
            if(modal) modal.style.display = 'none';
        }

        // Funciones de navegación
        function openExternalLink(url) {
            window.open(url, '_blank');
        }

        // Funciones para el Message Box personalizado
        function showMessageBox(message) {
            const messageBox = document.getElementById('messageBox');
            const messageText = document.getElementById('messageText');
            messageText.innerHTML = message;
            messageBox.style.display = 'flex';
        }

        function hideMessageBox() {
            document.getElementById('messageBox').style.display = 'none';
        }

        // --- NUEVA LÓGICA PARA EL SELECTOR DE COLOR ---
        function setupColorPicker() {
            const colorPicker = document.getElementById('colorPicker');
            const root = document.documentElement;

            // Función para actualizar el color
            const updateAccentColor = (color) => {
                root.style.setProperty('--accent-color', color);
                
                // Generar una versión más oscura para el hover
                const darkColor = pSBC(-0.2, color);
                root.style.setProperty('--accent-dark', darkColor);

                // Generar una versión transparente para sombras y brillos
                const transColor = hexToRgba(color, 0.15);
                root.style.setProperty('--accent-color-trans', transColor);
            };
            
            // Evento para cuando se cambia el color
            colorPicker.addEventListener('input', (e) => {
                updateAccentColor(e.target.value);
            });

            // Establecer el color inicial al cargar la página
            updateAccentColor(colorPicker.value);
        }

        // Función para aclarar/oscurecer colores (de https://stackoverflow.com/a/13532993)
        const pSBC=(p,c0,c1,l)=>{
            let r,g,b,P,f,t,h,i=parseInt,m=Math.round,a=typeof(c1)=="string";
            if(typeof(p)!="number"||p<-1||p>1||typeof(c0)!="string"||(c0[0]!='r'&&c0[0]!='#')||(c1&&!a))return null;
            if(!this.pSBCr)this.pSBCr=(d)=>{
                let n=d.length,x={};
                if(n>9){
                    [r,g,b,a]=d=d.split(","),n=d.length;
                    if(n<3||n>4)return null;
                    x.r=i(r[3]=="a"?r.slice(5):r.slice(4)),x.g=i(g),x.b=i(b),x.a=a?parseFloat(a):-1
                }else{
                    if(n==8||n==6||n<4)return null;
                    if(n<6)d="#"+d[1]+d[1]+d[2]+d[2]+d[3]+d[3]+(n>4?d[4]+d[4]:"");
                    d=i(d.slice(1),16);
                    if(n==9||n==5)x.r=d>>24&255,x.g=d>>16&255,x.b=d>>8&255,x.a=m((d&255)/0.255)/1000;
                    else x.r=d>>16,x.g=d>>8&255,x.b=d&255,x.a=-1
                }return x};
            h=c0.length>9,h=a?c1.length>9?true:c1=="c"?!h:false:h,f=this.pSBCr(c0),P=p<0,t=c1&&c1!="c"?this.pSBCr(c1):P?{r:0,g:0,b:0,a:-1}:{r:255,g:255,b:255,a:-1},p=P?p*-1:p,P=1-p;
            if(!f||!t)return null;
            if(l)r=m(P*f.r+p*t.r),g=m(P*f.g+p*t.g),b=m(P*f.b+p*t.b);
            else r=m((P*f.r**2+p*t.r**2)**0.5),g=m((P*f.g**2+p*t.g**2)**0.5),b=m((P*f.b**2+p*t.b**2)**0.5);
            a=f.a,t=t.a,f=a>=0||t>=0,a=f?a<0?t:t<0?a:a*P+t*p:0;
            if(h)return"rgb"+(f?"a(":"(")+r+","+g+","+b+(f?","+m(a*1000)/1000:"")+")";
            else return"#"+(4294967296+r*16777216+g*65536+b*256+(f?m(a*255):0)).toString(16).slice(1,f?undefined:-2)
        }

        // Función para convertir HEX a RGBA
        function hexToRgba(hex, alpha) {
            let r = 0, g = 0, b = 0;
            if (hex.length == 4) {
                r = "0x" + hex[1] + hex[1];
                g = "0x" + hex[2] + hex[2];
                b = "0x" + hex[3] + hex[3];
            } else if (hex.length == 7) {
                r = "0x" + hex[1] + hex[2];
                g = "0x" + hex[3] + hex[4];
                b = "0x" + hex[5] + hex[6];
            }
            return `rgba(${+r},${+g},${+b},${alpha})`;
        }


        // Error handling and user feedback improvements
        window.addEventListener('error', function(e) {
            console.error('JavaScript Error:', e.error);
            showMessageBox(`<h3 style='color: var(--accent-color);'>Error Detectado</h3><p>Se ha producido un error inesperado. Por favor, recarga la página e intenta de nuevo.</p><p style='font-size: 0.9rem; color: var(--text-secondary);'>Error: ${e.message}</p>`);
        });

        // Add loading states for better UX
        function showLoading(message = "Procesando...") {
            const loadingOverlay = document.createElement('div');
            loadingOverlay.id = 'loadingOverlay';
            loadingOverlay.style.cssText = `
                position: fixed; top: 0; left: 0; width: 100%; height: 100%;
                background: rgba(0, 0, 0, 0.7); backdrop-filter: blur(8px);
                display: flex; align-items: center; justify-content: center;
                z-index: 2000; color: var(--text-light); font-size: 1.2rem;
            `;
            loadingOverlay.innerHTML = `
                <div style="text-align: center;">
                    <div style="border: 3px solid transparent; border-top: 3px solid var(--accent-color); border-radius: 50%; width: 40px; height: 40px; animation: spin 1s linear infinite; margin: 0 auto 20px;"></div>
                    <p>${message}</p>
                </div>
            `;
            document.body.appendChild(loadingOverlay);
            
            // Add spin animation
            if (!document.getElementById('spin-style')) {
                const style = document.createElement('style');
                style.id = 'spin-style';
                style.textContent = '@keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }';
                document.head.appendChild(style);
            }
        }

        function hideLoading() {
            const overlay = document.getElementById('loadingOverlay');
            if (overlay) {
                overlay.remove();
            }
        }

        // Enhanced script generation with loading state
        const originalShowGeneratedCode = showGeneratedCode;
        showGeneratedCode = function() {
            showLoading("Generando script personalizado...");
            setTimeout(() => {
                try {
                    originalShowGeneratedCode();
                    hideLoading();
                } catch (error) {
                    hideLoading();
                    console.error('Error generating code:', error);
                    showMessageBox(`<h3 style='color: var(--accent-color);'>Error al Generar Script</h3><p>No se pudo generar el script. Por favor, verifica tus selecciones e intenta de nuevo.</p>`);
                }
            }, 500); // Small delay to show loading state
        };

        // Enhanced ZIP download with progress feedback
        const originalDownloadZip = downloadZipFromDisplay;
        downloadZipFromDisplay = async function() {
            showLoading("Generando archivo ZIP...");
            try {
                await originalDownloadZip();
            } catch (error) {
                hideLoading();
                console.error('Error downloading ZIP:', error);
                showMessageBox(`<h3 style='color: var(--accent-color);'>Error en Descarga</h3><p>No se pudo generar el archivo ZIP. Por favor, intenta de nuevo.</p>`);
            }
        };

        // Accessibility improvements
        function enhanceAccessibility() {
            // Add keyboard navigation support
            document.addEventListener('keydown', function(e) {
                if (e.key === 'Escape') {
                    // Close any open modals
                    const openModals = document.querySelectorAll('.modal[style*="flex"]');
                    openModals.forEach(modal => {
                        if (modal.id !== 'messageBox' && modal.id !== 'codeDisplayBox') {
                            modal.style.display = 'none';
                        }
                    });
                    
                    // Close message boxes
                    hideMessageBox();
                    closeModal('codeDisplayBox');
                }
            });

            // Add focus management for modals
            const modals = document.querySelectorAll('.modal');
            modals.forEach(modal => {
                modal.addEventListener('click', function(e) {
                    if (e.target === modal) {
                        modal.style.display = 'none';
                    }
                });
            });

            // Improve button accessibility
            const buttons = document.querySelectorAll('button, .btn, .tool-card, .tool-item');
            buttons.forEach(button => {
                if (!button.getAttribute('tabindex')) {
                    button.setAttribute('tabindex', '0');
                }
                
                button.addEventListener('keypress', function(e) {
                    if (e.key === 'Enter' || e.key === ' ') {
                        e.preventDefault();
                        button.click();
                    }
                });
            });
        }

        // Performance monitoring
        function monitorPerformance() {
            if ('performance' in window) {
                window.addEventListener('load', function() {
                    setTimeout(() => {
                        const perfData = performance.getEntriesByType('navigation')[0];
                        if (perfData) {
                            const loadTime = perfData.loadEventEnd - perfData.loadEventStart;
                            console.log(`Page load time: ${loadTime}ms`);
                            
                            // Log slow performance
                            if (loadTime > 3000) {
                                console.warn('Slow page load detected. Consider optimizing resources.');
                            }
                        }
                    }, 0);
                });
            }
        }

        // Validation improvements
        function validateSelection() {
            let totalSelected = 0;
            for (const category in selectedTools) {
                totalSelected += selectedTools[category].length;
            }
            
            if (totalSelected === 0) {
                showMessageBox(`<h3 style='color: var(--accent-color);'>Selección Requerida</h3><p>Por favor, selecciona al menos una herramienta antes de generar el script.</p><p style='color: var(--text-secondary); font-size: 0.9rem;'>Puedes explorar las diferentes categorías en el menú para encontrar las herramientas que necesitas.</p>`);
                return false;
            }
            
            if (totalSelected > 20) {
                const proceed = confirm(`Has seleccionado ${totalSelected} herramientas. Esto podría resultar en un script muy grande. ¿Deseas continuar?`);
                if (!proceed) {
                    return false;
                }
            }
            
            return true;
        }

        // Enhanced FAB button with validation
        const originalFabButton = document.getElementById('fabButton');
        if (originalFabButton) {
            originalFabButton.onclick = function() {
                if (validateSelection()) {
                    showGeneratedCode();
                }
            };
        }

        // Initialize all improvements
        document.addEventListener('DOMContentLoaded', function() {
            enhanceAccessibility();
            monitorPerformance();
            updateGlobalFloatingButton();
            setupColorPicker();
        });

        // ==================================================================
        // FIN DE LA LÓGICA DE LA APLICACIÓN
        // ==================================================================
    </script>
</body>
</html>
